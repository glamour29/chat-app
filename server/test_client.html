<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Chat 1-1</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        #messages { border: 1px solid #ccc; height: 300px; overflow-y: scroll; padding: 10px; margin-bottom: 10px; }
        .my-msg { text-align: right; color: blue; }
        .other-msg { text-align: left; color: green; }
    </style>
</head>
<body>
    <h2>üí¨ Test Chat Room</h2>
    
    <div>
        <label>Room ID (Gi·∫£): </label>
        <input type="text" id="roomId" value="65a1234567890abcdef12345">
        <button onclick="joinRoom()">V√†o ph√≤ng</button>
    </div>
    <hr>

    <div id="messages"></div>

    <input type="text" id="msgInput" placeholder="Nh·∫≠p tin nh·∫Øn..." style="width: 70%;">
    <button onclick="sendMessage()">G·ª≠i</button>

    <script>
        // ‚ö†Ô∏è D√ÅN TOKEN C·ª¶A B·∫†N V√ÄO ƒê√ÇY
        const MY_TOKEN = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2OTY2MzIxZmRjZTM2Mzg0ZjI4YWVlODUiLCJpYXQiOjE3NjgzMDUyNDIsImV4cCI6MTc3MDg5NzI0Mn0.kbOm-QoRK1zg1ky8eYgMna0P7Vo0j7C-nxSoEd98gnw"; 

        const socket = io("http://localhost:3000", {
            auth: { token: MY_TOKEN }
        });

        let currentRoom = "";

        socket.on("connect", () => {
            console.log("‚úÖ K·∫øt n·ªëi th√†nh c√¥ng!");
            addLog("System", "ƒê√£ k·∫øt n·ªëi t·ªõi Server");
        });

        // H√†m tham gia ph√≤ng
        function joinRoom() {
            const roomId = document.getElementById("roomId").value;
            currentRoom = roomId;
            socket.emit("join_room", roomId);
            addLog("System", "ƒêang v√†o ph√≤ng: " + roomId);
        }

        // Nghe s·ª± ki·ªán nh·∫≠n tin nh·∫Øn t·ª´ ng∆∞·ªùi kh√°c
        socket.on("receive_message", (data) => {
            console.log("Tin m·ªõi:", data);
            const sender = (data.senderId === socket.id) ? "Me" : data.senderId; // Ch·ªâ l√† hi·ªÉn th·ªã t·∫°m
            addLog(sender, data.content);
        });

        // H√†m g·ª≠i tin
        function sendMessage() {
            const content = document.getElementById("msgInput").value;
            if (!currentRoom) {
                alert("Vui l√≤ng b·∫•m 'V√†o ph√≤ng' tr∆∞·ªõc!");
                return;
            }
            
            // G·ª≠i l√™n server
            socket.emit("send_message", {
                roomId: currentRoom,
                content: content
            });

            document.getElementById("msgInput").value = "";
        }

        // H√†m hi·ªÉn th·ªã log l√™n m√†n h√¨nh
        function addLog(sender, msg) {
            const div = document.createElement("div");
            div.innerHTML = `<b>${sender}:</b> ${msg}`;
            document.getElementById("messages").appendChild(div);
        }

        socket.on("connect_error", (err) => alert("L·ªói: " + err.message));
    </script>
</body>
</html>